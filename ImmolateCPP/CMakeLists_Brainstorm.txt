cmake_minimum_required(VERSION 3.10)
project(BrainstormDLL LANGUAGES CXX)

# Set C++ standard and required flags
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# Define sources for the DLL
set(DLL_SOURCES
    src/brainstorm_enhanced.cpp
    src/functions.cpp
    src/functions.hpp
    src/instance.hpp
    src/items.cpp
    src/items.hpp
    src/rng.cpp
    src/rng.hpp
    src/search.cpp
    src/search.hpp
    src/seed.cpp
    src/seed.hpp
    src/util.cpp
    src/util.hpp
)

# Set optimization flags based on the compiler
if(MSVC)
    set(OPTIMIZATION_FLAGS "/O2 /MD")  # Optimization for MSVC with dynamic runtime
    set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS ON)
else()
    set(OPTIMIZATION_FLAGS "-O3 -fPIC")  # Full optimization for GCC/Clang
endif()

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OPTIMIZATION_FLAGS}")

# Create the DLL
add_library(Immolate SHARED ${DLL_SOURCES})

# Define BUILDING_DLL when compiling the DLL
target_compile_definitions(Immolate PRIVATE BUILDING_DLL)

# Set output properties
set_target_properties(Immolate PROPERTIES
    PREFIX ""
    OUTPUT_NAME "Immolate"
    RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}"
    LIBRARY_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}"
    ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}"
)

# Windows specific settings
if(WIN32)
    set_target_properties(Immolate PROPERTIES
        SUFFIX ".dll"
    )
endif()